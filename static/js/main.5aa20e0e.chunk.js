(this["webpackJsonpavax-chat-dapp"]=this["webpackJsonpavax-chat-dapp"]||[]).push([[0],{84:function(e,t){},99:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(28),s=n.n(r),c=n(3),i=n.n(c),u=n(23),l=n(24),d=n(103),p=n(101),o=n(67),b=n(107),j=n(108),h=n(105),y=n(106),x=n(7);function m(e){return Object(x.jsxs)(y.a,{bg:"dark",variant:"dark",children:[Object(x.jsx)(y.a.Brand,{href:"#home",children:"Avalanche Chat App"}),Object(x.jsx)(y.a.Toggle,{}),Object(x.jsx)(y.a.Collapse,{className:"justify-content-end",children:Object(x.jsxs)(y.a.Text,{children:[Object(x.jsx)(j.a,{style:{display:e.showButton},variant:"success",onClick:Object(u.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.login();case 1:case"end":return t.stop()}}),t)}))),children:"Connect to Metamask"}),Object(x.jsxs)("div",{style:{display:"none"===e.showButton?"block":"none"},children:["Signed in as:",Object(x.jsx)("a",{href:"#",children:e.username})]})]})})]})}var f=n(104);function g(e){var t=Object(a.useState)(!1),n=Object(l.a)(t,2),r=n[0],s=n[1],c=function(){return s(!1)};return Object(x.jsxs)("div",{className:"AddNewChat",style:{position:"absolute",bottom:"0px",padding:"10px 45px 0 45px",margin:"0 95px 0 0",width:"97%"},children:[Object(x.jsx)(j.a,{variant:"success",className:"mb-2",onClick:function(){return s(!0)},children:"+ NewChat"}),Object(x.jsxs)(f.a,{show:r,onHide:c,children:[Object(x.jsx)(f.a.Header,{closeButton:!0,children:Object(x.jsx)(f.a.Title,{children:" Add New Friend "})}),Object(x.jsx)(f.a.Body,{children:Object(x.jsxs)(h.a.Group,{children:[Object(x.jsx)(h.a.Control,{required:!0,id:"addPublicKey",size:"text",type:"text",placeholder:"Enter Friends Public Key"}),Object(x.jsx)("br",{}),Object(x.jsx)(h.a.Control,{required:!0,id:"addName",size:"text",type:"text",placeholder:"Name"}),Object(x.jsx)("br",{})]})}),Object(x.jsxs)(f.a.Footer,{children:[Object(x.jsx)(j.a,{variant:"secondary",onClick:c,children:"Close"}),Object(x.jsx)(j.a,{variant:"primary",onClick:function(){e.addHandler(document.getElementById("addName").value,document.getElementById("addPublicKey").value),c()},children:"Add Friend"})]})]})]})}function O(e){return Object(x.jsx)(p.a,{style:{marginRight:"0px"},children:Object(x.jsx)(b.a,{border:"success",style:{width:"80%",alignSelf:"center",margin:"0 0 5px "+e.marginLeft,float:"right",right:"0px"},children:Object(x.jsxs)(b.a.Body,{children:[Object(x.jsx)("h6",{style:{float:"right"},children:e.timeStamp}),Object(x.jsx)(b.a.Subtitle,{children:Object(x.jsx)("b",{children:e.sender})}),Object(x.jsx)(b.a.Text,{children:e.data})]})})})}n(82);function v(e){return Object(x.jsx)(p.a,{style:{marginRight:"0px"},children:Object(x.jsx)(b.a,{border:"success",style:{width:"100%",alignSelf:"center",marginLeft:"15px"},onClick:function(){e.getMessages(e.publicKey)},children:Object(x.jsxs)(b.a.Body,{children:[Object(x.jsxs)(b.a.Title,{children:[" ",e.name," "]}),Object(x.jsxs)(b.a.Subtitle,{children:[" ",e.publicKey.length>20?e.publicKey.substring(0,20)+" ...":e.publicKey," "]})]})})})}var w=n(56),k=[{inputs:[{internalType:"address",name:"friend_key",type:"address"},{internalType:"string",name:"name",type:"string"}],name:"addFriend",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"pubkey",type:"address"}],name:"checkUserExists",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"name",type:"string"}],name:"createAccount",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getMyFriendList",outputs:[{components:[{internalType:"address",name:"pubkey",type:"address"},{internalType:"string",name:"name",type:"string"}],internalType:"struct Database.friend[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"pubkey",type:"address"}],name:"getUsername",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"friend_key",type:"address"}],name:"readMessage",outputs:[{components:[{internalType:"address",name:"sender",type:"address"},{internalType:"uint256",name:"timestamp",type:"uint256"},{internalType:"string",name:"msg",type:"string"}],internalType:"struct Database.message[]",name:"",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"friend_key",type:"address"},{internalType:"string",name:"_msg",type:"string"}],name:"sendMessage",outputs:[],stateMutability:"nonpayable",type:"function"}],C="0xF02C9B63dDaA173AA8a7794B559200A3f0418E92";function S(e){var t,n,r=Object(a.useState)(null),s=Object(l.a)(r,2),c=s[0],y=s[1],f=Object(a.useState)(null),S=Object(l.a)(f,2),T=S[0],K=S[1],M=Object(a.useState)(null),B=Object(l.a)(M,2),D=B[0],E=B[1],A=Object(a.useState)({friendname:null,publicKey:null}),N=Object(l.a)(A,2),F=N[0],R=N[1],I=Object(a.useState)(null),L=Object(l.a)(I,2),H=L[0],U=L[1],P=Object(a.useState)("block"),_=Object(l.a)(P,2),G=_[0],Y=_[1],q=Object(a.useState)(null),z=Object(l.a)(q,2),J=z[0],W=z[1],Q=k;function V(){return X.apply(this,arguments)}function X(){return(X=Object(u.a)(i.a.mark((function e(){var a,r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z();case 2:if(!0!==e.sent){e.next=35;break}return t=new w.a.providers.Web3Provider(window.ethereum),n=t.getSigner(),e.prev=6,a=new w.a.Contract(C,Q,n),W(a),e.next=11,n.getAddress();case 11:return r=e.sent,e.next=14,a.checkUserExists(r);case 14:if(!e.sent){e.next=21;break}return e.next=18,a.getUsername(r);case 18:s=e.sent,e.next=25;break;case 21:return""===(s=prompt("Enter a username","Guest"))&&(s="Guest"),e.next=25,a.createAccount(s);case 25:K(s),E(r),Y("none"),e.next=33;break;case 30:e.prev=30,e.t0=e.catch(6),alert("CONTRACT_ADDRESS not set properly!");case 33:e.next=36;break;case 35:alert("Couldn't connect to Metamask");case 36:case"end":return e.stop()}}),e,null,[[6,30]])})))).apply(this,arguments)}function Z(){return $.apply(this,arguments)}function $(){return($=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.ethereum.enable();case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function ee(){return(ee=Object(u.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,J.checkUserExists(n);case 3:if(e.sent){e.next=7;break}return alert("Given address not found: Ask him to join the app :)"),e.abrupt("return");case 7:return e.prev=7,e.next=10,J.addFriend(n,t);case 10:a={name:t,publicKey:n},y(c.concat(a)),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),alert("Friend already Added! You can't be friend with the same person twice ;P");case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(0),alert("Invalid address!");case 22:case"end":return e.stop()}}),e,null,[[0,19],[7,14]])})))).apply(this,arguments)}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=Object(u.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F&&F.publicKey){e.next=2;break}return e.abrupt("return");case 2:return n=F.publicKey,e.next=5,J.sendMessage(n,t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return re.apply(this,arguments)}function re(){return(re=Object(u.a)(i.a.mark((function e(t){var n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],c.forEach((function(e){e.publicKey===t&&(n=e.name)})),e.next=4,J.readMessage(t);case 4:e.sent.forEach((function(e){var t=new Date(1e3*e[1].toNumber()).toUTCString();a.push({publicKey:e[0],timeStamp:t,data:e[2]})})),R({friendname:n,publicKey:t}),U(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(a.useEffect)((function(){function e(){return(e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,J.getMyFriendList();case 4:e.sent.forEach((function(e){t.push({publicKey:e[0],name:e[1]})})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t=null;case 11:y(t);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[D,J]);var se=H?H.map((function(e){var t="5%",n=F.friendname;return e.publicKey===D&&(t="15%",n="You"),Object(x.jsx)(O,{marginLeft:t,sender:n,data:e.data,timeStamp:e.timeStamp})})):null,ce=c?c.map((function(e){return Object(x.jsx)(v,{publicKey:e.publicKey,name:e.name,getMessages:function(e){return ae(e)}})})):null;return Object(x.jsxs)(d.a,{style:{padding:"0px",border:"1px solid grey"},children:[Object(x.jsx)(m,{username:T,login:Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",V());case 1:case"end":return e.stop()}}),e)}))),showButton:G}),Object(x.jsxs)(p.a,{children:[Object(x.jsx)(o.a,{style:{paddingRight:"0px",borderRight:"2px solid #000000"},children:Object(x.jsxs)("div",{style:{backgroundColor:"#DCDCDC",height:"100%",overflowY:"auto"},children:[Object(x.jsx)(p.a,{style:{marginRight:"0px"},children:Object(x.jsx)(b.a,{style:{width:"100%",alignSelf:"center",marginLeft:"15px"},children:Object(x.jsx)(b.a.Header,{children:"Chats"})})}),ce,Object(x.jsx)(g,{myContract:J,addHandler:function(e,t){return function(e,t){return ee.apply(this,arguments)}(e,t)}})]})}),Object(x.jsx)(o.a,{xs:8,style:{paddingLeft:"0px"},children:Object(x.jsxs)("div",{style:{backgroundColor:"#DCDCDC",height:"100%"},children:[Object(x.jsx)(p.a,{style:{marginRight:"0px"},children:Object(x.jsx)(b.a,{style:{width:"100%",alignSelf:"center",margin:"0 0 5px 15px"},children:Object(x.jsxs)(b.a.Header,{children:[F.friendname," : ",F.publicKey,Object(x.jsx)(j.a,{style:{float:"right"},variant:"warning",onClick:function(){F&&F.publicKey&&ae(F.publicKey)},children:"Refresh"})]})})}),Object(x.jsx)("div",{className:"MessageBox",style:{height:"400px",overflowY:"auto"},children:se}),Object(x.jsx)("div",{className:"SendMessage",style:{borderTop:"2px solid black",position:"relative",bottom:"0px",padding:"10px 45px 0 45px",margin:"0 95px 0 0",width:"97%"},children:Object(x.jsx)(h.a,{onSubmit:function(e){e.preventDefault(),te(document.getElementById("messageData").value),document.getElementById("messageData").value=""},children:Object(x.jsxs)(h.a.Row,{className:"align-items-center",children:[Object(x.jsx)(o.a,{xs:9,children:Object(x.jsx)(h.a.Control,{id:"messageData",className:"mb-2",placeholder:"Send Message"})}),Object(x.jsx)(o.a,{children:Object(x.jsx)(j.a,{className:"mb-2",style:{float:"right"},onClick:function(){te(document.getElementById("messageData").value),document.getElementById("messageData").value=""},children:"Send"})})]})})})]})})]})]})}s.a.render(Object(x.jsx)(S,{}),document.getElementById("root"))}},[[99,1,2]]]);
//# sourceMappingURL=main.5aa20e0e.chunk.js.map